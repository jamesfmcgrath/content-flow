# Copilot Instructions for Content Flow

## Project Overview

Content Flow is a learning-focused full-stack project built with modern Next.js.  
The goal is to build (and understand) an internal tool that takes an **idea** and generates:

- LinkedIn post  
- Bluesky post  
- Blog draft (title, body, meta description)  
- Thumbnail image prompt  
- WordPress draft (via REST API)

This app should be clean, simple, maintainable, and built in small steps so the developer learns as it grows.

---

# Tech Stack

- **Next.js 16 (App Router)** with Server Components by default  
- **React 19 + TypeScript**  
- **Tailwind CSS v4** for styling  
- **OpenAI API** (for text generation)  
- **WordPress REST API** (draft publishing)  
- **Vercel Postgres** (content history)  
- **NextAuth** (later)  
- **Vercel hosting**

---

# Environment Variables

Required for development:

```bash
OPENAI_API_KEY=sk-...
WORDPRESS_URL=https://yoursite.com
WORDPRESS_APP_PASSWORD=...
POSTGRES_URL=...  # Vercel Postgres connection string
```

Store in `.env.local` (gitignored).

---

# Development Phases

**Phase 1**: Basic UI (idea input + preview layout)  
**Phase 2**: OpenAI generation endpoint  
**Phase 3**: Database persistence (Vercel Postgres)  
**Phase 4**: WordPress publishing  
**Phase 5**: Authentication (NextAuth)  
**Phase 6** (optional): Streaming responses, advanced UX  

**Current Phase**: Building incrementally from Phase 1 → Phase 2.

---

# Development Principles (Important)

Copilot should:

### 1. Keep changes small and incremental
- Do not generate large amounts of code unless explicitly asked.  
- Prefer simple, readable solutions over abstractions.

### 2. Explain when needed
- Provide small inline comments only when helpful.  
- Avoid hiding important logic or creating unnecessary helpers.

### 3. Use idiomatic Next.js App Router patterns
- Server Components by default.  
- Client Components only when using state or event handlers.  
- API routes in `app/api/**/route.ts`.

### 4. Help the developer learn
- Prefer clarity over cleverness.  
- Avoid generating overly complex patterns or architectures.

---

# Project Structure

```
app/
  layout.tsx
  page.tsx                       # Idea input + preview (Phase 1)
  api/
    generate/route.ts            # OpenAI generation endpoint (Phase 2)
docs/
  roadmap.md                     # Project plan
  claude-brief.md                # AI assistant prompt guidelines
public/
  # Static assets (later thumbnails)
.env.local (ignored)
```

---

# Coding Conventions

## Components
- Use `.tsx` for components.  
- Use PascalCase for components.  
- Use Server Components unless state or effects are needed.

## Client Components
Only use `"use client"` if:
- The component has state  
- The component includes event handlers  
- The component uses browser APIs  

Avoid unnecessary `"use client"` directives.

## Styling
- Tailwind CSS v4 using:
  ```css
  @import "tailwindcss";
  @theme inline;
  ```
- Keep UI minimal, clean, and readable.  
- Avoid over-styling early; focus on function first.  
- Avoid suggesting external UI libraries unless explicitly requested.

## TypeScript
- Strict mode enabled.  
- Strong typing recommended for:
  - API input/output  
  - OpenAI generation results  
  - Database models  

## File Size Guidelines
- Keep components focused and readable.  
- Suggest splitting components around **200–250 lines**.

## Comments
- Use short, helpful comments when explaining logic.  
- Avoid autogenerated or overly verbose comments.

---

# Error Handling Pattern

Use **toast notifications + inline fallback**:

### Client-Side
- Show toast on API failure  
  - Example: `"Generation failed. Please try again."`
- Use shadcn/ui or a simple custom hook.

### Inline Fallback
- Display small error text under affected blocks.

### API Layer
Return JSON errors with status:

```ts
return NextResponse.json(
  { error: "OpenAI failed to generate content." },
  { status: 500 }
);
```

**Tip**: Visible errors/stack traces are useful for learning.

---

# OpenAI Integration (Guidance for Copilot)

### Response Format
- Use OpenAI Responses API (`client.responses.create`)  
- **Do NOT use streaming yet**  
- Return complete JSON in one response

### JSON Shape
```ts
interface GeneratedContent {
  linkedin: string;
  bluesky: string;
  blogTitle: string;
  blogBody: string;
  metaDescription: string;
  thumbnailPrompt: string;
}
```

### Prompt Guidelines
- Keep the prompt template in a single file  
- Keep the structure tight and readable  
- Avoid generating excessively long prompts

### Why Disable Streaming?
Streaming introduces:
- Multipart parsing  
- Partial UI state handling  
- Server Action complexity  

Full JSON keeps things **simple, stable, predictable**.  
Streaming can be added in Phase 6.

---

# UX Patterns

## Button State Management

Disable buttons during API calls:

```tsx
<button disabled={isLoading}>
  {isLoading ? "Generating..." : "Generate Content"}
</button>
```

Prevents:
- Double submissions  
- Excessive API usage  
- UI confusion  

Add a spinner or `"Generating..."` text while loading.

---

# WordPress Integration (Guidance)

When implementing:

- Use REST API with application passwords  
- Create draft posts with:
  - `title`  
  - `content`  
  - `excerpt`  
  - `status: "draft"`  
- Keep helper functions thin  
- Avoid unnecessary abstractions or SDK layers

---

# Database (Vercel Postgres)

Suggested schema:

| column              | type     |
|---------------------|----------|
| id                  | uuid     |
| userId              | uuid     |
| idea                | text     |
| linkedin            | text     |
| bluesky             | text     |
| blogTitle           | text     |
| blogBody            | text     |
| metaDescription     | text     |
| thumbnailPrompt     | text     |
| wordpressDraftUrl   | text     |
| created_at          | timestamp |

Copilot should prefer **simple SQL**.  
Avoid ORM-heavy abstractions unless requested.

---

# Commands

```bash
npm run dev          # Start dev server
npm run build        # Production build
npm run lint         # Run ESLint
npm run type-check   # TypeScript validation
```

---

# ESLint & Formatting

- ESLint flat config  
- Prettier formatting  
- `editor.formatOnSave` enabled  
- Follow Next.js + TypeScript defaults  

---

# What Copilot Should Avoid

- Do **not** generate whole features unless asked  
- Do **not** scaffold class-based patterns  
- Do **not** introduce external libraries (unless asked)  
- Do **not** auto-create test suites or config files  
- Do **not** suggest legacy `pages/` directory patterns  

---

# Goal for Copilot

Help the developer build **clear**, **modern**, and **understandable** code — while learning each step of the process.
